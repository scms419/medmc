<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Database</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/easymde/dist/easymde.min.css">
    <link rel="stylesheet" href="mde-config.css">
</head>
<body>
    <div>
        MedMC:
        <a href="index.html">Home</a>
        <a href="form-input.html">Self-check Test</a>
        <a href="database.html">Database</a>
    </div>
    <hr>
    <div id="bar" style="width: 100%; justify-content: space-evenly; display: flex;">
        <input type="button" id="prevButton" value="Previous Question" style="width: 150px;">
        <span style="width: 40%; justify-content: space-evenly; display: flex">
            <label for="selectQuestion">Question code:</label>
            <select id="selectQuestion" style="width: 60%"></select>
        </span>
        <input type="button" id="nextButton" value="Next Question" style="width: 150px;">
    </div><br>
    <div id="information" style="width: 100%; justify-content: space-evenly; display: flex;">
        <span style="width: 30%; justify-content: space-evenly; display: flex">
            <label for="selectCourse">Course:</label>
            <select id="selectCourse" style="width: 60%"></select>
        </span>
        <span style="width: 30%; justify-content: space-evenly; display: flex">
            <label for="selectTopic">Topic:</label>
            <select id="selectTopic" style="width: 60%"></select>
        </span>
        <span style="width: 10%; justify-content: space-evenly; display: flex">
            <label for="questionId">ID:</label>
            <input type="text" id="questionId" style="width: 60%">
        </span>
        <span style="width: 10%; justify-content: space-evenly; display: flex">
            <label for="questionYear">Year:</label>
            <input type="text" id="questionYear" style="width: 30%">
        </span>
        <span style="width: 10%; justify-content: space-evenly; display: flex">
            <label for="questionNumber">No.:</label>
            <input type="number" id="questionNumber" style="width: 30%">
        </span>
    </div><br>
    <div id="questionEditor">
        <label for="question">Question:</label>
        <textarea id="question"></textarea>
    </div>
    <div id="optionEditor"></div>
    <div id="explanationEditor"></div>
    <script src="https://cdn.jsdelivr.net/npm/easymde/dist/easymde.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="mde-config.js"></script>
    <script>
        function createMDE(id, sideBySide, horizontal=true) {
            const editor = new EasyMDE({
                element: document.getElementById(id),
                sideBySideFullscreen: false,
                minHeight: (sideBySide && !horizontal) ? "31.4px" : "300px",
                previewRender: (plainText) => marked.parse(plainText),
                toolbar: [
                    "bold",
                    "italic",
                    {
                        name: "underline",
                        className: "fa fa-underline",
                        action: toggleUnderline,
                        title: "Underline (Ctrl-U)",
                    },
                    "strikethrough",
                    {
                        name: "subscript",
                        className: "fa fa-subscript",
                        action: toggleSubscript,
                        title: "Subscript (Ctrl-Shift-_)"
                    },
                    {
                        name: "superscript",
                        className: "fa fa-superscript",
                        action: toggleSuperscript,
                        title: "Superscript (Ctrl-Shift-+)"
                    },
                    "|",
                    "heading-1",
                    "heading-2",
                    "heading-3",
                    "|",
                    {
                        name: "unordered-list",
                        className: "fa fa-list-ul",
                        action: toggleUnorderedList,
                        title: "Unordered list"
                    },
                    {
                        name: "ordered-list",
                        className: "fa fa-list-ol",
                        title: "Ordered list",
                        children: [
                            {
                                name: "numbered-list",
                                icon: "1",
                                action: toggleOrderedList_number,
                                title: "Numbered list"
                            },
                            {
                                name: "capital-lettered-list",
                                action: toggleOrderedList_capitalLetter,
                                title: "Capital-lettered list"
                            },
                            {
                                name: "small-lettered-list",
                                icon: "a",
                                action: toggleOrderedList_smallLetter,
                                title: "Small-lettered list"
                            },
                            {
                                name: "capital-roman-numeral-list",
                                icon: "I",
                                action: toggleOrderedList_capitalRoman,
                                title: "Capital-roman-numeral list"
                            },
                            {
                                name: "small-roman-numeral-list",
                                icon: "i",
                                action: toggleOrderedList_smallRoman,
                                title: "Small-roman-numeral list"
                            }
                        ]
                    },
                    "|",
                    "upload-image",
                    "table",
                    "|",
                    {
                        name: "undo",
                        className: "fa fa-undo",
                        action: EasyMDE.undo,
                        title: "Undo (Ctrl-Z)"
                    },
                    {
                        name: "redo",
                        className: "fa fa-repeat fa-redo",
                        action: EasyMDE.redo,
                        title: "Redo (Ctrl-Y)"
                    }
                ],
                shortcuts: {
                    "toggleUnorderedList": null,
                    "toggleOrderedList": null
                }
            });
            if (sideBySide) {
                horizontal ? editor.toggleSideBySide() : editor.toggleSideBySideV();
            }
            const originalKeys = editor.codemirror.getOption("extraKeys") || {};
            editor.codemirror.setOption("extraKeys", {
                ...originalKeys,
                "Ctrl-U": (cm) => toggleUnderline(editor),
                "Shift-Ctrl--": (cm) => toggleSubscript(editor),
                "Shift-Ctrl-=": (cm) => toggleSuperscript(editor),
                "Enter": (cm) => newLineAndContinueList(editor)
            });
            let cm = editor.codemirror;
            cm.on("cursorActivity", function () {
                var startPoint = cm.getCursor('start');
                var endPoint = cm.getCursor('end');
                var text = cm.getLine(startPoint.line);
                if (isPatterned(text, startPoint.ch, endPoint.ch, "u"))
                    document.querySelector(`#${id}Editor > div > div.editor-toolbar > button.underline`).classList.add("active");
                else
                    document.querySelector(`#${id}Editor > div > div.editor-toolbar > button.underline`).classList.remove("active");
                if (isPatterned(text, startPoint.ch, endPoint.ch, "sub"))
                    document.querySelector(`#${id}Editor > div > div.editor-toolbar > button.subscript`).classList.add("active");
                else
                    document.querySelector(`#${id}Editor > div > div.editor-toolbar > button.subscript`).classList.remove("active");
                if (isPatterned(text, startPoint.ch, endPoint.ch, "sup"))
                    document.querySelector(`#${id}Editor > div > div.editor-toolbar > button.superscript`).classList.add("active");
                else
                    document.querySelector(`#${id}Editor > div > div.editor-toolbar > button.superscript`).classList.remove("active");
                if (/^(\s*)(\d+\.|[A-Za-z]+\.|[iIvVxX]+\.)(\s+)/.test(text))
                    document.querySelector(`#${id}Editor > div > div.editor-toolbar > button.ordered-list`).classList.add("active");
                else
                    document.querySelector(`#${id}Editor > div > div.editor-toolbar > button.ordered-list`).classList.remove("active");
            })
            const map = ["numbered-list", "capital-lettered-list", "small-lettered-list", "capital-roman-numeral-list", "small-roman-numeral-list"];
            for (let name of map) {
                document.querySelector(`.${name}`).innerHTML = `<img src="icon/${name}.png" width="20" height="20">`
            }
            return editor;
        }
        const customOrderedList = {
            name: "customOrderedList",
            level: "block",
            start(src) {
                return src.match(/(?:^|\n)(\s*)(\d+\.|[A-Za-z]+\.|[iIvVxX]+\.)(\s+)/)?.index;
            },
            tokenizer(src, tokens) {
                const rule = /^([^\S\r\n]*)(\d+|[A-Za-z]+|[iIvVxX]+)(\.)(\s+)(.*)/;
                const match = rule.exec(src);
                let style;
                if (match) {
                    if (/\d+/.test(match[2])) style = "1";
                    else if (/[IVX]+/.test(match[2])) style = "I";
                    else if (/[ivx]+/.test(match[2])) style = "i";
                    else if (/[A-Z]+/.test(match[2])) style = "A";
                    else if (/[a-z]+/.test(match[2])) style = "a";
                    const items = [];
                    let remainingSrc = src;
                    let prevIndent = match[1].length;
                    while (remainingSrc) {
                        const itemMatch = rule.exec(remainingSrc);
                        if (!itemMatch || itemMatch[1].length !== prevIndent) break;
                        let itemStyle;
                        if (/\d+/.test(itemMatch[2])) itemStyle = "1";
                        else if (/[IVX]+/.test(itemMatch[2])) itemStyle = "I";
                        else if (/[ivx]+/.test(itemMatch[2])) itemStyle = "i";
                        else if (/[A-Z]+/.test(itemMatch[2])) itemStyle = "A";
                        else if (/[a-z]+/.test(itemMatch[2])) itemStyle = "a";
                        else break;
                        if (itemStyle !== style) break;
                        const itemText = itemMatch[5].trim();
                        const itemTokens = [];
                        this.lexer.inlineTokens(itemText, itemTokens);
                        items.push({
                            type: "customOrderedListItem",
                            raw: itemMatch[0],
                            tokens: itemTokens
                        });
                        remainingSrc = remainingSrc.slice(itemMatch.index + itemMatch[0].length + 1);
                    }
                    const token = {
                        type: "customOrderedList",
                        raw: src.slice(0, src.length - remainingSrc.length),
                        style: style,
                        items: items
                    };
                    return token;
                }
            },
            renderer(token) {
                const listItems = token.items.map(item =>
                    `<li>${this.parser.parseInline(item.tokens)}</li>`
                ).join('\n');
                return `<ol type="${token.style}">\n${listItems}\n</ol>\n`;
            },
            childTokens: ["items"]
        };
        marked.use({ breaks: true });
        marked.use({ extensions: [customOrderedList] });
        const questionEditor = createMDE("question", true);
    </script>
</body>
</html>